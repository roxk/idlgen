<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <Native-Platform Condition="'$(Platform)' == 'Win32'">x86</Native-Platform>
        <Native-Platform Condition="'$(Platform)' != 'Win32'">$(Platform)</Native-Platform>
		<IdlGenCppGenerateIDL Condition="'$(IdlGenCppGenerateIDL)' == ''">true</IdlGenCppGenerateIDL>
		<IdlGenExclude Condition="'$(IdlGenExclude)' == ''">App.h;pch.h</IdlGenExclude>
    </PropertyGroup>
	<PropertyGroup>
		<IdlGenCppIncludeDirs>$(GeneratedFilesDir);$(VC_IncludePath);$(WindowsSDK_IncludePath);$(MSBuildThisFileDirectory)..\..\include</IdlGenCppIncludeDirs>
	</PropertyGroup>
	<ItemGroup Condition="'$(IdlGenInclude)' == ''">
		<IdlGenCppInclude Include="@(ClInclude)" Exclude="$(IdlGenExclude)" />
	</ItemGroup>
	<ItemGroup Condition="'$(IdlGenInclude)' != ''">
		<IdlGenCppInclude Include="$(IdlGenInclude)" Exclude="$(IdlGenExclude)" />
	</ItemGroup>
	<ItemGroup>
		<IdlGenCppIncludeDirs Include="$(IdlGenCppIncludeDirs)"/>
	</ItemGroup>
	<ItemDefinitionGroup>
		<IdlGenCppInclude>
			<IdlOutput>%(RelativeDir)%(Filename).idl</IdlOutput>
		</IdlGenCppInclude>
	</ItemDefinitionGroup>
	<Target Name="GenerateIDLfromCppHeaders" BeforeTargets="ClCompile" Inputs="@(IdlGenCppInclude)" Outputs="%(IdlOutput)" Condition="'$(IdlGenCppGenerateIDL)' == 'true'">
		<Message Text="%(IdlGenCppInclude.Identity)" Importance="high" />
		<Exec Command="$(MSBuildThisFileDirectory)..\..\bin\$(Platform)\idlgen.exe --gen %(IdlGenCppInclude.Identity) @(IdlGenCppIncludeDirs->'--include=&quot;%(Identity)&quot;'->Replace('\','/'), ' ')" />
	</Target>
	<Target Name="StartGenerateIDLfromCppHeaders" BeforeTargets="GenerateIDLfromCppHeaders" Condition="'$(IdlGenCppGenerateIDL)' == 'true'">
		<Message Text="Running idlgen on C++ header" Importance="high" />
	</Target>
</Project>
